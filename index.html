<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WAI4 Secure Suite</title>

<style>
:root{
    --bg:#f4f6f8;
    --panel:#ffffff;
    --border:#d1d5db;
    --text:#111827;
    --muted:#6b7280;
    --accent:#2563eb;
    --accent-hover:#1e40af;
}

body{
    margin:0;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:var(--bg);
    color:var(--text);
    padding:24px;
}

.container{
    max-width:860px;
    margin:auto;
}

h1{
    text-align:center;
    margin-bottom:32px;
    font-size:28px;
    letter-spacing:0.5px;
}

h2{
    margin-top:0;
    font-size:20px;
}

.box{
    background:var(--panel);
    padding:24px;
    border-radius:10px;
    border:1px solid var(--border);
    margin-bottom:24px;
}

textarea,
input{
    width:100%;
    padding:12px;
    margin-top:8px;
    margin-bottom:14px;
    border-radius:6px;
    border:1px solid var(--border);
    font-size:14px;
    background:#fff;
}

textarea{
    resize:vertical;
    min-height:100px;
}

button{
    padding:10px 16px;
    border-radius:6px;
    border:1px solid var(--accent);
    background:var(--accent);
    color:#fff;
    font-size:14px;
    cursor:pointer;
    margin-right:6px;
}

button:hover{
    background:var(--accent-hover);
}

.result{
    word-break:break-all;
    background:#f9fafb;
    border:1px dashed var(--border);
    padding:12px;
    border-radius:6px;
    font-size:13px;
    cursor:pointer;
}

.result:active{
    background:#eef2ff;
}

.hidden{
    display:none;
}

.small{
    font-size:12px;
    color:var(--muted);
    text-align:center;
}
</style>
</head>
<body>

<div class="container">

<h1>WAI4 Secure Suite</h1>

<div id="loginBox" class="box">
<h2>Login</h2>
<input type="password" id="masterInput" placeholder="Enter master key">
<button onclick="login()">Login</button>
<button onclick="generateMaster()">Generate Master Key</button>
<div class="result" id="masterDisplay" onclick="copyText(this)">
Generated key will appear here (tap to copy)
</div>
</div>

<div id="appBox" class="hidden">

<div class="box">
<h2>Encryption</h2>
<textarea id="plain" placeholder="Enter plaintext"></textarea>

<input type="password" id="cryptoPass" placeholder="Encryption password">
<button onclick="generateCrypto()">Generate 100-character Key</button>

<div class="result" id="cryptoDisplay" onclick="copyText(this)">
Generated key will appear here (tap to copy)
</div>

<button onclick="encrypt()">Encrypt</button>
<div class="result" id="enc_result" onclick="copyText(this)"></div>
</div>

<div class="box">
<h2>Decryption</h2>
<textarea id="cipher" placeholder="Enter ciphertext"></textarea>
<input type="password" id="cryptoPassDec" placeholder="Encryption password">
<button onclick="decrypt()">Decrypt</button>
<div class="result" id="dec_result"></div>
</div>

<p class="small">Tap any result field to copy</p>

</div>
</div>

<script>
/* ðŸ”’ Logic intentionally unchanged */
const ITERATION = 200000;
let storedMasterHash = null;

function randomString(len){
    const chars =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ"+
        "abcdefghijklmnopqrstuvwxyz"+
        "0123456789"+
        "!@#$%^&*()-_=+[]{}<>?";
    const array = new Uint32Array(len);
    crypto.getRandomValues(array);
    return Array.from(array,x=>chars[x%chars.length]).join("");
}

async function sha256(text){
    const enc = new TextEncoder();
    const hash = await crypto.subtle.digest("SHA-256",enc.encode(text));
    return btoa(String.fromCharCode(...new Uint8Array(hash)));
}

async function generateMaster(){
    const key = randomString(150);
    storedMasterHash = await sha256(key);
    const el = document.getElementById("masterDisplay");
    el.innerText = key;
}

async function login(){
    const input = document.getElementById("masterInput").value;
    if(!storedMasterHash){ alert("Generate a master key first"); return; }
    const hash = await sha256(input);
    if(hash === storedMasterHash){
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("appBox").classList.remove("hidden");
    }else{
        alert("Login failed");
    }
}

function generateCrypto(){
    const key = randomString(100);
    document.getElementById("cryptoPass").value = key;
    document.getElementById("cryptoDisplay").innerText = key;
}

function copyText(element){
    const text = element.innerText;
    if(!text || text.includes("appear")) return;

    if(navigator.clipboard && window.isSecureContext){
        navigator.clipboard.writeText(text);
    }else{
        const temp=document.createElement("textarea");
        temp.value=text;
        document.body.appendChild(temp);
        temp.select();
        document.execCommand("copy");
        document.body.removeChild(temp);
    }
}

function b64uEnc(bytes){
    let bin="";
    bytes.forEach(b=>bin+=String.fromCharCode(b));
    return btoa(bin).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
}
function b64uDec(str){
    str=str.replace(/-/g,"+").replace(/_/g,"/");
    while(str.length%4) str+="=";
    return Uint8Array.from(atob(str),c=>c.charCodeAt(0));
}

async function deriveKey(password,salt){
    const enc=new TextEncoder();
    const keyMat=await crypto.subtle.importKey(
        "raw",enc.encode(password),
        {name:"PBKDF2"},
        false,
        ["deriveKey"]
    );
    return crypto.subtle.deriveKey(
        {name:"PBKDF2",salt,iterations:ITERATION,hash:"SHA-256"},
        keyMat,
        {name:"AES-GCM",length:256},
        false,
        ["encrypt","decrypt"]
    );
}

async function encrypt(){
    const pass=document.getElementById("cryptoPass").value;
    const text=document.getElementById("plain").value;
    if(pass.length<12){ alert("Password too short"); return; }

    const salt=crypto.getRandomValues(new Uint8Array(16));
    const iv=crypto.getRandomValues(new Uint8Array(12));
    const key=await deriveKey(pass,salt);

    const cipher=await crypto.subtle.encrypt(
        {name:"AES-GCM",iv},
        key,
        new TextEncoder().encode(text)
    );

    const combined=new Uint8Array(16+12+cipher.byteLength);
    combined.set(salt,0);
    combined.set(iv,16);
    combined.set(new Uint8Array(cipher),28);

    document.getElementById("enc_result").innerText =
        "WAI4|"+ITERATION+"|"+b64uEnc(combined);
}

async function decrypt(){
    const pass=document.getElementById("cryptoPassDec").value;
    const text=document.getElementById("cipher").value.trim();
    if(!text.startsWith("WAI4|")) return;

    const parts=text.split("|");
    const bytes=b64uDec(parts[2]);

    const salt=bytes.slice(0,16);
    const iv=bytes.slice(16,28);
    const cipher=bytes.slice(28);

    try{
        const key=await deriveKey(pass,salt);
        const plain=await crypto.subtle.decrypt(
            {name:"AES-GCM",iv},
            key,
            cipher
        );
        document.getElementById("dec_result").innerText =
            new TextDecoder().decode(plain);
    }catch{
        document.getElementById("dec_result").innerText="Decryption failed";
    }
}
</script>
</body>
</html>
